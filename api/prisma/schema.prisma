generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  CLIENT
  ADMIN
  ESTHETICIENNE
  SUPERADMIN
}

model User {
  id           Int      @id @default(autoincrement())
  firstName    String
  lastName     String
  email        String   @unique
  phone        String?  @unique
  passwordHash String
  role         UserRole @default(CLIENT)
  isActive     Boolean  @default(true)
  isAdmin      Boolean  @default(false)

  /// null = email non vérifié
  emailVerifiedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // RDV où l'utilisateur est client
  clientAppointments       Appointment[] @relation("ClientAppointments")
  // RDV où l'utilisateur est praticienne
  practitionerAppointments Appointment[] @relation("PractitionerAppointments")

  /// tokens de vérification liés à cet utilisateur
  emailVerificationTokens EmailVerificationToken[]
}

model Category {
  id          Int     @id @default(autoincrement())
  name        String
  slug        String  @unique
  description String?
  order       Int     @default(0)
  isActive    Boolean @default(true)

  services Service[]
}

model Service {
  id               Int     @id @default(autoincrement())
  name             String
  slug             String  @unique
  shortDescription String?
  description      String?
  imageUrl         String?
  isFeatured       Boolean @default(false)
  isActive         Boolean @default(true)
  orderInCategory  Int     @default(0)

  priceCents      Int?
  durationMinutes Int?

  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])

  options ServiceOption[]

  /// un service peut être réservé dans plusieurs rendez-vous
  appointments Appointment[]
}

model ServiceOption {
  id         Int    @id @default(autoincrement())
  name       String
  duration   Int?
  priceCents Int

  serviceId Int
  service   Service @relation(fields: [serviceId], references: [id])

  /// une option peut être utilisée dans plusieurs rendez-vous
  appointments Appointment[]
}

enum AppointmentStatus {
  BOOKED
  COMPLETED
  CANCELLED
}

model Appointment {
  id      Int      @id @default(autoincrement())
  startAt DateTime

  // Client
  userId Int
  user   User @relation(
    "ClientAppointments",
    fields: [userId],
    references: [id],
    onDelete: Cascade
  )

  // Praticienne
  practitionerId Int
  practitioner   User @relation(
    "PractitionerAppointments",
    fields: [practitionerId],
    references: [id],
    onDelete: Cascade
  )

  serviceId Int
  service   Service @relation(fields: [serviceId], references: [id])

  serviceOptionId Int?
  serviceOption   ServiceOption? @relation(fields: [serviceOptionId], references: [id])

  status    AppointmentStatus @default(BOOKED)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}

model EmailVerificationToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  userId    Int
  user      User @relation(
    fields: [userId],
    references: [id],
    onDelete: Cascade
  )
  expiresAt DateTime
  createdAt DateTime @default(now())
}
