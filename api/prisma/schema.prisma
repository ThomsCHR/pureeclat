generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  CLIENT
  ADMIN
  ESTHETICIENNE
}

model User {
  id           Int      @id @default(autoincrement())
  firstName    String
  lastName     String
  email        String   @unique
  phone        String?  @unique
  passwordHash String
  role         UserRole @default(CLIENT)
  isActive     Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // RDV oÃ¹ l'utilisateur est client
  clientAppointments       Appointment[] @relation("ClientAppointments")
  // RDV oÃ¹ l'utilisateur est praticienne
  practitionerAppointments Appointment[] @relation("PractitionerAppointments")
}

model Category {
  id          Int     @id @default(autoincrement())
  name        String
  slug        String  @unique
  description String?
  order       Int     @default(0)
  isActive    Boolean @default(true)

  services Service[]
}

model Service {
  id               Int     @id @default(autoincrement())
  name             String
  slug             String  @unique
  shortDescription String?
  description      String?
  imageUrl         String?
  isFeatured       Boolean @default(false)
  isActive         Boolean @default(true)
  orderInCategory  Int     @default(0)

  priceCents      Int?
  durationMinutes Int?

  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])

  options ServiceOption[]

  /// ðŸ‘‡ un service peut Ãªtre rÃ©servÃ© dans plusieurs rendez-vous
  appointments Appointment[]
}

model ServiceOption {
  id         Int    @id @default(autoincrement())
  name       String
  duration   Int?
  priceCents Int

  serviceId Int
  service   Service @relation(fields: [serviceId], references: [id])

  /// ðŸ‘‡ une option peut Ãªtre utilisÃ©e dans plusieurs rendez-vous
  appointments Appointment[]
}

enum AppointmentStatus {
  BOOKED
  COMPLETED
  CANCELLED
}

model Appointment {
  id      Int      @id @default(autoincrement())
  startAt DateTime

  // Client
  userId Int
  user   User @relation("ClientAppointments", fields: [userId], references: [id])

  // Praticienne
  practitionerId Int
  practitioner   User @relation("PractitionerAppointments", fields: [practitionerId], references: [id])

  serviceId       Int
  service         Service        @relation(fields: [serviceId], references: [id])

  serviceOptionId Int?
  serviceOption   ServiceOption? @relation(fields: [serviceOptionId], references: [id])

  status    AppointmentStatus @default(BOOKED)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}